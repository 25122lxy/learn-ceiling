(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{353:function(a,t,s){"use strict";s.r(t);var e=s(1),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"nacos注册中心"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nacos注册中心"}},[a._v("#")]),a._v(" Nacos注册中心")]),a._v(" "),t("h2",{attrs:{id:"_1-认识和安装nacos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-认识和安装nacos"}},[a._v("#")]),a._v(" 1. 认识和安装Nacos")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://nacos.io/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Nacos"),t("OutboundLink")],1),a._v("是阿里巴巴的产品，现在是"),t("a",{attrs:{href:"https://spring.io/projects/spring-cloud",target:"_blank",rel:"noopener noreferrer"}},[a._v("SpringCloud"),t("OutboundLink")],1),a._v("中的一个组件。相比"),t("a",{attrs:{href:"https://github.com/Netflix/eureka",target:"_blank",rel:"noopener noreferrer"}},[a._v("Eureka"),t("OutboundLink")],1),a._v("功能更加丰富，在国内受欢迎程度较高。")]),a._v(" "),t("h3",{attrs:{id:"_1-windows安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-windows安装"}},[a._v("#")]),a._v(" 1. Windows安装")]),a._v(" "),t("p",[t("strong",[a._v("下载安装包")])]),a._v(" "),t("p",[a._v("在Nacos的GitHub页面，提供有下载链接，可以下载编译好的Nacos服务端或者源代码：")]),a._v(" "),t("p",[a._v("GitHub主页：https://github.com/alibaba/nacos")]),a._v(" "),t("p",[a._v("GitHub的Release下载页：https://github.com/alibaba/nacos/releases")]),a._v(" "),t("p",[a._v("windows版本使用"),t("code",[a._v("nacos-server-1.4.4.zip")]),a._v("包即可。")]),a._v(" "),t("p",[t("strong",[a._v("解压")])]),a._v(" "),t("p",[a._v("目录说明：")]),a._v(" "),t("ul",[t("li",[a._v("bin：启动脚本")]),a._v(" "),t("li",[a._v("conf：配置文件")])]),a._v(" "),t("p",[t("strong",[a._v("端口配置")])]),a._v(" "),t("p",[a._v("Nacos的默认端口是8848，如果你电脑上的其它进程占用了8848端口，请先尝试关闭该进程。")]),a._v(" "),t("p",[t("strong",[a._v("如果无法关闭占用8848端口的进程")]),a._v("，也可以进入nacos的conf目录，修改配置文件中的端口：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606164029391.png",alt:"image-20230606164029391"}})]),a._v(" "),t("p",[a._v("修改其中的内容：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606164829040.png",alt:"image-20230606164829040"}})]),a._v(" "),t("p",[t("strong",[a._v("启动")])]),a._v(" "),t("p",[a._v("执行命令启动单机版")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("startup.cmd "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" standalone\n")])])]),t("p",[t("strong",[a._v("访问")])]),a._v(" "),t("p",[a._v("http://127.0.0.1:8848/nacos")]),a._v(" "),t("p",[a._v("默认的账号和密码都是nacos")]),a._v(" "),t("p",[a._v("登录成功即可")]),a._v(" "),t("h3",{attrs:{id:"_2-linux安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-linux安装"}},[a._v("#")]),a._v(" 2. Linux安装")]),a._v(" "),t("p",[a._v("后续补充。。。")]),a._v(" "),t("h3",{attrs:{id:"_3-nacos依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-nacos依赖"}},[a._v("#")]),a._v(" 3.Nacos依赖")]),a._v(" "),t("p",[a._v("父工程：")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-alibaba-dependencies"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("2.3.6.RELEASE"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("pom"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("import"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("p",[a._v("客户端：")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("\x3c!-- nacos客户端依赖包 --\x3e")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-alibaba-nacos-discovery"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n\n")])])]),t("h2",{attrs:{id:"_2-服务注册到nacos"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务注册到nacos"}},[a._v("#")]),a._v(" 2. 服务注册到Nacos")]),a._v(" "),t("p",[a._v("Nacos是SpringCloudAlibaba的组件，而SpringCloudAlibaba也遵循SpringCloud中定义的服务注册、服务发现规范。因此使用Nacos和使用Eureka对于微服务来说，并没有太大区别。")]),a._v(" "),t("p",[a._v("主要差异在于：")]),a._v(" "),t("ul",[t("li",[a._v("依赖不同")]),a._v(" "),t("li",[a._v("服务地址不同")])]),a._v(" "),t("p",[t("strong",[a._v("添加依赖")])]),a._v(" "),t("p",[a._v("在cloud-demo父工程的pom文件中的"),t("code",[a._v("<dependencyManagement>")]),a._v("中引入SpringCloudAlibaba的依赖:")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-alibaba-dependencies"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("2.3.6.RELEASE"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("pom"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("import"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("p",[a._v("然后在user-service和order-service中的pom文件中引入nacos-discovery依赖：")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-alibaba-nacos-discovery"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("blockquote",[t("p",[t("strong",[a._v("注意")]),a._v("：这里需要注释掉eureka的依赖。")])]),a._v(" "),t("p",[t("strong",[a._v("配置nacos地址")])]),a._v(" "),t("p",[a._v("在user-service和order-service的application.yml中添加nacos地址：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("\n")])])]),t("blockquote",[t("p",[t("strong",[a._v("注意")]),a._v("：这里需要注释掉eureka的地址")])]),a._v(" "),t("p",[t("strong",[a._v("重启")])]),a._v(" "),t("p",[a._v("重启微服务后，登录nacos管理页面，可以看到微服务信息：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606164908625.png",alt:"image-20230606164908625"}})]),a._v(" "),t("h2",{attrs:{id:"_3-服务分级存储模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-服务分级存储模型"}},[a._v("#")]),a._v(" 3. 服务分级存储模型")]),a._v(" "),t("p",[a._v("一个"),t("strong",[a._v("服务")]),a._v("可以有多个"),t("strong",[a._v("实例")]),a._v("，例如我们的user-service，可以有:")]),a._v(" "),t("ul",[t("li",[a._v("127.0.0.1:8081")]),a._v(" "),t("li",[a._v("127.0.0.1:8082")]),a._v(" "),t("li",[a._v("127.0.0.1:8083")])]),a._v(" "),t("p",[a._v("假如这些实例分布于全国各地的不同机房，例如：")]),a._v(" "),t("ul",[t("li",[a._v("127.0.0.1:8081，在上海机房")]),a._v(" "),t("li",[a._v("127.0.0.1:8082，在上海机房")]),a._v(" "),t("li",[a._v("127.0.0.1:8083，在杭州机房")])]),a._v(" "),t("p",[a._v("Nacos就将同一机房内的实例 划分为一个"),t("strong",[a._v("集群")]),a._v("。")]),a._v(" "),t("p",[a._v("也就是说，user-service是服务，一个服务可以包含多个集群，如杭州、上海，每个集群下可以有多个实例，形成分级模型，如图：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606165003505.png",alt:"image-20230606165003505"}})]),a._v(" "),t("p",[a._v("微服务互相访问时，应该尽可能访问同集群实例，因为本地访问速度更快。当本集群内不可用时，才访问其它集群。例如：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606165024128.png",alt:"image-20230606165024128"}})]),a._v(" "),t("p",[a._v("杭州机房内的order-service应该优先访问同机房的user-service。")]),a._v(" "),t("h3",{attrs:{id:"_3-1-给user-service配置集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-给user-service配置集群"}},[a._v("#")]),a._v(" 3.1 给user-service配置集群")]),a._v(" "),t("p",[a._v("修改user-service的application.yml文件，添加集群配置：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#nacos服务地址")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cluster-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" HZ "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 集群名称，HZ代指杭州，SH代指上海 8083在idea中配置了SH")]),a._v("\n")])])]),t("p",[a._v("重启两个user-service实例后，我们可以在nacos控制台看到下面结果：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606170126438.png",alt:"image-20230606170126438"}})]),a._v(" "),t("p",[a._v("我们再次复制一个user-service启动配置，添加属性：")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Dserver.port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8083")]),a._v(" -Dspring.cloud.nacos.discovery.cluster-name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("SH\n")])])]),t("p",[a._v("配置如下图所示")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606170249261.png",alt:"image-20230606170249261"}})]),a._v(" "),t("p",[a._v("启动UserApplication3后再次查看nacos控制台：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606170306919.png",alt:"image-20230606170306919"}})]),a._v(" "),t("h3",{attrs:{id:"_3-2-同集群优先的负载均衡"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-同集群优先的负载均衡"}},[a._v("#")]),a._v(" 3.2 同集群优先的负载均衡")]),a._v(" "),t("p",[a._v("默认的"),t("code",[a._v("ZoneAvoidanceRule")]),a._v("并不能实现根据同集群优先来实现负载均衡。")]),a._v(" "),t("p",[a._v("因此Nacos中提供了一个"),t("code",[a._v("NacosRule")]),a._v("的实现，可以优先从同集群中挑选实例。")]),a._v(" "),t("p",[t("strong",[a._v("就是说服务消费者优先从同集群挑选服务提供者")])]),a._v(" "),t("p",[a._v("1）给order-service配置集群信息")]),a._v(" "),t("p",[a._v("修改order-service的application.yml文件，添加集群配置：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cluster-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" HZ "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 集群名称")]),a._v("\n")])])]),t("p",[a._v("2）修改负载均衡规则")]),a._v(" "),t("p",[a._v("修改order-service的application.yml文件，修改负载均衡规则：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("userservice")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ribbon")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("NFLoadBalancerRuleClassName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" com.alibaba.cloud.nacos.ribbon.NacosRule "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# nacos负载均衡规则 ")]),a._v("\n")])])]),t("h2",{attrs:{id:"_4-权重配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-权重配置"}},[a._v("#")]),a._v(" 4. 权重配置")]),a._v(" "),t("p",[a._v("实际部署中会出现这样的场景：")]),a._v(" "),t("p",[a._v("服务器设备性能有差异，部分实例所在机器性能较好，另一些较差，我们希望性能好的机器承担更多的用户请求。")]),a._v(" "),t("p",[a._v("但默认情况下NacosRule是同集群内随机挑选，不会考虑机器的性能问题。")]),a._v(" "),t("p",[a._v("因此，Nacos提供了权重配置来控制访问频率，权重越大则访问频率越高。")]),a._v(" "),t("p",[a._v("在nacos控制台，找到user-service的实例列表，点击编辑，即可修改权重：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606171712570.png",alt:"image-20230606171712570"}})]),a._v(" "),t("p",[a._v("在弹出的编辑窗口，修改权重：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606171728691.png",alt:"image-20230606171728691"}})]),a._v(" "),t("blockquote",[t("p",[t("strong",[a._v("注意")]),a._v("：如果权重修改为0，则该实例永远不会被访问")])]),a._v(" "),t("h2",{attrs:{id:"_5-环境隔离"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-环境隔离"}},[a._v("#")]),a._v(" 5. 环境隔离")]),a._v(" "),t("p",[a._v("Nacos提供了namespace来实现环境隔离功能。")]),a._v(" "),t("ul",[t("li",[a._v("nacos中可以有多个namespace")]),a._v(" "),t("li",[a._v("namespace下可以有group、service等")]),a._v(" "),t("li",[a._v("不同namespace之间相互隔离，例如不同namespace的服务互相不可见")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606171815078.png",alt:"image-20230606171815078"}})]),a._v(" "),t("h3",{attrs:{id:"_5-1-创建namespace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-创建namespace"}},[a._v("#")]),a._v(" 5.1 创建namespace")]),a._v(" "),t("p",[a._v("默认情况下，所有service、data、group都在同一个namespace，名为public：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606171831682.png",alt:"image-20230606171831682"}})]),a._v(" "),t("p",[a._v("我们可以点击页面新增按钮，添加一个namespace：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606171903469.png",alt:"image-20230606171903469"}})]),a._v(" "),t("p",[a._v("然后填写表单：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606171926202.png",alt:"image-20230606171926202"}})]),a._v(" "),t("p",[a._v("就能在页面看到一个新的namespace：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606171939088.png",alt:"image-20230606171939088"}})]),a._v(" "),t("h3",{attrs:{id:"_5-2-给微服务配置namespace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-给微服务配置namespace"}},[a._v("#")]),a._v(" 5.2 给微服务配置namespace")]),a._v(" "),t("p",[a._v("给微服务配置namespace只能通过修改配置来实现。")]),a._v(" "),t("p",[a._v("例如，修改order-service的application.yml文件：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cluster-name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" HZ\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 492a7d5d"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("237b"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("46a1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("a99a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("fa8e98e4b0f9 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 命名空间，填ID")]),a._v("\n")])])]),t("p",[a._v("重启order-service后，访问控制台，可以看到下面的结果：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606172053627.png",alt:"image-20230606172053627"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606172103795.png",alt:"image-20230606172103795"}})]),a._v(" "),t("p",[a._v("此时访问order-service，因为namespace不同，会导致找不到userservice，控制台会报错：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606172115984.png",alt:"image-20230606172115984"}})]),a._v(" "),t("h2",{attrs:{id:"_6-nacos和rureka的区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-nacos和rureka的区别"}},[a._v("#")]),a._v(" 6. Nacos和Rureka的区别")]),a._v(" "),t("p",[a._v("Nacos的服务实例分为两种l类型：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("临时实例：如果实例宕机超过一定时间，会从服务列表剔除，默认的类型。")])]),a._v(" "),t("li",[t("p",[a._v("非临时实例：如果实例宕机，不会从服务列表剔除，也可以叫永久实例。")])])]),a._v(" "),t("p",[a._v("配置一个服务实例为永久实例：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ephemeral")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置为非临时实例")]),a._v("\n")])])]),t("p",[a._v("Nacos和Eureka整体结构类似，服务注册、服务拉取、心跳等待，但是也存在一些差异：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gitee.com/tjlxy/img/raw/master/image-20230606172304515.png",alt:"image-20230606172304515"}})]),a._v(" "),t("ul",[t("li",[t("p",[a._v("Nacos与eureka的共同点")]),a._v(" "),t("ul",[t("li",[a._v("都支持服务注册和服务拉取")]),a._v(" "),t("li",[a._v("都支持服务提供者心跳方式做健康检测")])])]),a._v(" "),t("li",[t("p",[a._v("Nacos与Eureka的区别")]),a._v(" "),t("ul",[t("li",[a._v("Nacos支持服务端主动检测提供者状态：临时实例采用心跳模式，非临时实例采用主动检测模式")]),a._v(" "),t("li",[a._v("临时实例心跳不正常会被剔除，非临时实例则不会被剔除")]),a._v(" "),t("li",[a._v("Nacos支持服务列表变更的消息推送模式，服务列表更新更及时")]),a._v(" "),t("li",[a._v("Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式；Eureka采用AP方式")])])])])])}),[],!1,null,null,null);t.default=n.exports}}]);